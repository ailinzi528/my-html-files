<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Map with Popup</title>
    <style>
        body, html { margin: 0; padding: 0; height: 100%; }
        #map { width: 100%; height: 100vh; }


        /* 自定义弹窗样式 */
        .mapboxgl-popup {
            background: rgba(255, 0, 0, 0.5); /* 弹窗背景颜色 */
            color: black; /* 字体颜色 */
            border-radius: 15px; /* 圆角 */
            padding: 15px; /* 内边距 */
            max-width: 400px; /* 最大宽度 */
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5); /* 阴影 */
        }
        .mapboxgl-popup-content {
            font-size: 16px; /* 字体大小 */
            background: none; /* 去掉弹窗内容背景 */
            padding: 0; /* 去掉内容内边距 */
        }
        .mapboxgl-popup img {
            max-width: 100%; /* 确保图片不会超出弹窗的宽度 */
        }
        .mapboxgl-popup a {
            color: #00f; /* 链接颜色 */
            text-decoration: underline; /* 链接下划线 */
        }
    </style>
    <script src='https://api.mapbox.com/mapbox-gl-js/v3.5.1/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v3.5.1/mapbox-gl.css' rel='stylesheet' />
</head>
<body>
<div id="map"></div>

<script>
    mapboxgl.accessToken = 'pk.eyJ1IjoiYWlsaW56aTUyOCIsImEiOiJjbHp0ZXQxZ3oyY2JuMnJyNHdxc2xndW94In0.1rfDN-c2Pjk5TztXwd0OLg';

    const map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/ailinzi528/clzs9eijl00e001pibjwi5e0o',
        center: [104.066, 30.650],
        zoom: 12
    });

    map.on('load', function() {
        // Add GeoJSON data source
        map.addSource('geojson-data', {
            type: 'geojson',
            data: 'wts2024_0814.geojson'
        });

        // Add layer for polygons
        map.addLayer({
            id: 'polygons',
            type: 'fill',
            source: 'geojson-data',
            filter: ['==', '$type', 'Polygon'],
            paint: {
                'fill-color': '#888888',
                'fill-opacity': 0
            }
        });

        // 添加边框虚线
        map.addLayer({
            'id': 'polygon-border',
            'type': 'line',
            'source': 'geojson-data', // 确保这里的 source 名称与上面的匹配
            'filter': ['==', '$type', 'Polygon'], // 添加过滤器以确保只选择多边形
            'paint': {
                'line-color': '#04ff00',
                'line-width': 4,
                'line-dasharray': [2, 3] // 虚线样式
            }
        });

        // Add layer for points
        map.addLayer({
            id: 'points',
            type: 'circle',
            source: 'geojson-data',
            filter: ['==', '$type', 'Point'],
            paint: {
                'circle-radius': 10,
                'circle-color': '#007cbf',
                'circle-opacity': 0
            }
        });

        // Add click event to display popup
        map.on('click', 'points', function(e) {
            const features = e.features[0];
            const name = features.properties.name || '未命名';
            const img = features.properties.img || '';
            const index = features.properties['1_index'] || '#';
            const link = features.properties['3_link'] || '#';
            const description = features.properties.description || '';

            new mapboxgl.Popup({ offset: 25 })
                .setLngLat(e.lngLat)
                .setHTML(`
                    <div style="font-size: 16px; font-weight: bold; margin-bottom: 10px;">${name}</div>
                    <p style="margin-bottom: 10px;">${index}</p>
                    <p style="margin-bottom: 10px;">${description}</p>
                    <img src="${img}" alt="${name}" style="width: 100%; height: auto; margin-bottom: 10px;">
                    <a href="${link}" target="_blank" style="font-size: 14px; color: #007cbf;">查看大图</a>
                `)
                .addTo(map);
        });

        // Change cursor to pointer on hover
        map.on('mouseenter', 'points', function() {
            map.getCanvas().style.cursor = 'pointer';
        });

        map.on('mouseenter', 'polygons', function() {
            map.getCanvas().style.cursor = 'pointer';
        });

        // Change cursor back to default on mouse leave
        map.on('mouseleave', 'points', function() {
            map.getCanvas().style.cursor = '';
        });

        map.on('mouseleave', 'polygons', function() {
            map.getCanvas().style.cursor = '';
        });
    });
</script>
</body>
</html>

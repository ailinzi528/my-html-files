<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Map with Popup</title>
    <style>
        body, html { margin: 0; padding: 0; height: 100%; }
        #map { width: 100%; height: 100vh; }
    </style>
    <script src='https://api.mapbox.com/mapbox-gl-js/v3.5.1/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v3.5.1/mapbox-gl.css' rel='stylesheet' />
</head>
<body>
<div id="map"></div>

<script>
    mapboxgl.accessToken = 'pk.eyJ1IjoiYWlsaW56aTUyOCIsImEiOiJjbHp0ZXQxZ3oyY2JuMnJyNHdxc2xndW94In0.1rfDN-c2Pjk5TztXwd0OLg';

    const map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/ailinzi528/clzs9eijl00e001pibjwi5e0o',
        center: [104.066, 30.650],
        zoom: 12
    });

    map.on('load', function() {
        // Add GeoJSON data source
        map.addSource('geojson-data', {
            type: 'geojson',
            data: 'wts2024_0814.geojson'
        });

        // Add layer for polygons
        map.addLayer({
            id: 'polygons',
            type: 'fill',
            source: 'geojson-data',
            filter: ['==', '$type', 'Polygon'],
            paint: {
                'fill-color': '#888888',
                'fill-opacity': 0.4
            }
        });

        // Add layer for points
        map.addLayer({
            id: 'points',
            type: 'circle',
            source: 'geojson-data',
            filter: ['==', '$type', 'Point'],
            paint: {
                'circle-radius': 10,
                'circle-color': '#007cbf',
                'circle-opacity': 0

            }
        });

        // Add click event to display popup
        map.on('click', 'points', function(e) {
            const features = e.features[0];
            const name = features.properties.name || '未命名';
            const img = features.properties.img || '';
            const index= features.properties['1_index'] || '#';
            const link = features.properties['3_link'] || '#';
            const description = features.properties.description || '';

            new mapboxgl.Popup({ offset: 25 })
                .setLngLat(e.lngLat)
                .setHTML(`
        <div style="font-size: 16px; font-weight: bold; margin-bottom: 10px; max-width: 300px;">${name}</div>
        <p style="max-width: 300px; margin-bottom: 10px;">${index}</p>
        <p style="max-width: 300px; margin-bottom: 10px;">${description}</p>
        
        <!-- 图片 -->
        <img src="${img}" alt="${name}" style="width: 100%; height: auto; margin-bottom: 10px; display: block;">

        <!-- 查看大图链接 -->
        <a href="${link}" target="_blank" style="font-size: 14px; color: #007cbf; display: block; margin-top: 10px;">查看大图</a>
    `)
                .addTo(map);
        });



        // Change cursor to pointer on hover
        map.on('mouseenter', 'points', function() {
            map.getCanvas().style.cursor = 'pointer';
        });

        map.on('mouseenter', 'polygons', function() {
            map.getCanvas().style.cursor = 'pointer';
        });

        // Change cursor back to default on mouse leave
        map.on('mouseleave', 'points', function() {
            map.getCanvas().style.cursor = '';
        });

        map.on('mouseleave', 'polygons', function() {
            map.getCanvas().style.cursor = '';
        });
    });
</script>
</body>
</html>
